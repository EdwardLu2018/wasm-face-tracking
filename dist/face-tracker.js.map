{"version":3,"sources":["webpack://FaceTracker/webpack/universalModuleDefinition","webpack://FaceTracker/webpack/bootstrap","webpack://FaceTracker/./src/face-tracker-lib.js","webpack://FaceTracker/./src/face-tracker.js","webpack://FaceTracker/./src/grayscale.js","webpack://FaceTracker/./src/shaders/flip-image.glsl","webpack://FaceTracker/./src/shaders/grayscale.glsl"],"names":["FaceTracker","constructor","width","height","init_callback","progress_callback","_this","ready","_width","_height","_init_callback","_progress_callback","_bboxLength","_landmarksLength","_featuresLength","_rotLength","_transLength","_poseLength","FaceDetectorWasm","then","Module","console","log","onWasmInit","getShapePredictor","_Module","initializeShapePredictor","cwrap","detectFaceFeatures","findPose","imBuf","_malloc","landmarksPtr","Uint16Array","BYTES_PER_ELEMENT","callback","req","XMLHttpRequest","addEventListener","e","shapePredictorProgress","open","responseType","onload","payload","response","shapePredictorInit","send","lengthComputable","downloadProgress","loaded","total","data","model","Uint8Array","buf","length","HEAPU8","set","detectFeatures","im","ptr","features","HEAPU16","buffer","bbox","slice","landmarksRaw","_free","landmarks","getPose","pose","Float64Array","HEAPF64","quat","trans","rotation","translation","isMobile","mobile","a","test","substr","navigator","userAgent","vendor","window","opera","GrayScaleMedia","source","canvas","_source","_canvas","document","createElement","_flipImageProg","require","_grayscaleProg","glReady","initGL","vertShaderSource","fragShaderSource","gl","getContext","viewport","drawingBufferWidth","drawingBufferHeight","clearColor","clear","COLOR_BUFFER_BIT","vertShader","createShader","VERTEX_SHADER","fragShader","FRAGMENT_SHADER","shaderSource","compileShader","program","createProgram","attachShader","linkProgram","useProgram","vertices","Float32Array","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","positionLocation","getAttribLocation","vertexAttribPointer","FLOAT","enableVertexAttribArray","flipYLocation","getUniformLocation","flipXLocation","uniform1f","texture","createTexture","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_MAG_FILTER","pixelBuf","grayBuf","flipHorizontal","getFrame","undefined","texImage2D","RGBA","UNSIGNED_BYTE","drawArrays","TRIANGLES","readPixels","j","i","requestStream","Promise","resolve","reject","mediaDevices","getUserMedia","aspect","audio","video","ideal","aspectRatio","facingMode","stream","srcObject","onloadedmetadata","play","catch","err"],"mappings":"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","file":"face-tracker.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"FaceTracker\"] = factory();\n\telse\n\t\troot[\"FaceTracker\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/face-tracker-lib.js\");\n","import { FaceTracker } from \"./face-tracker.js\"\nimport { GrayScaleMedia } from \"./grayscale.js\"\n\nexport { FaceTracker, GrayScaleMedia }\n","export class FaceTracker {\n    constructor(width, height, init_callback, progress_callback) {\n        let _this = this;\n        this.ready = false;\n\n        this._width = width;\n        this._height = height;\n\n        this._init_callback = init_callback;\n        this._progress_callback = progress_callback;\n\n        this._bboxLength = 4;\n        this._landmarksLength = 2 * 68;\n        this._featuresLength = this._landmarksLength + this._bboxLength;\n        this._rotLength = 4;\n        this._transLength = 3;\n        this._poseLength = this._rotLength + this._transLength;\n\n        FaceDetectorWasm().then(function (Module) {\n            console.log(\"Face Detector WASM module loaded.\");\n            _this.onWasmInit(Module);\n            _this.getShapePredictor();\n        });\n    }\n\n    onWasmInit(Module) {\n        this._Module = Module;\n\n        this.initializeShapePredictor = this._Module.cwrap(\"pose_model_init\", null, [\"number\", \"number\"]);\n        this.detectFaceFeatures = this._Module.cwrap(\"detect_face_features\", \"number\", [\"number\", \"number\", \"number\"]);\n        this.findPose = this._Module.cwrap(\"get_pose\", \"number\", [\"number\", \"number\", \"number\"]);\n\n        this.imBuf = this._Module._malloc(this._width * this._height);\n        this.landmarksPtr = this._Module._malloc(this._landmarksLength * Uint16Array.BYTES_PER_ELEMENT);\n    }\n\n    getShapePredictor(callback) {\n        const req = new XMLHttpRequest();\n        req.addEventListener('progress', e => this.shapePredictorProgress(e));\n        req.open(\"GET\", \"/shape_predictor_68_face_landmarks_compressed.dat\", true);\n        req.responseType = \"arraybuffer\";\n        req.onload = e => {\n            const payload = req.response;\n            if (payload) {\n                this.shapePredictorInit(payload);\n            }\n        }\n        req.send(null);\n    }\n\n    shapePredictorProgress(e) {\n        if (e.lengthComputable) {\n            const downloadProgress = (e.loaded / e.total) * 100;\n            if (downloadProgress < 100) {\n                this._progress_callback(downloadProgress);\n            }\n        }\n        else {\n            console.log(\"Cannot log face model download progress!\");\n        }\n    }\n\n    shapePredictorInit(data) {\n        const model = new Uint8Array(data);\n        const buf = this._Module._malloc(model.length);\n        this._Module.HEAPU8.set(model, buf);\n        this.initializeShapePredictor(buf, model.length);\n        this._init_callback();\n        this.ready = true;\n    }\n\n    detectFeatures(im) {\n        this._Module.HEAPU8.set(im, this.imBuf);\n\n        // console.time(\"features\");\n        const ptr = this.detectFaceFeatures(this.imBuf, this._width, this._height);\n        // console.timeEnd(\"features\");\n        let features = new Uint16Array(this._Module.HEAPU16.buffer, ptr, this._featuresLength);\n\n        const bbox = features.slice(0, this._bboxLength);\n        const landmarksRaw = features.slice(this._bboxLength, this._featuresLength);\n\n        this._Module._free(ptr);\n\n        return {\n            bbox: bbox,\n            landmarks: landmarksRaw\n        };\n    }\n\n    getPose(landmarks) {\n        this._Module.HEAPU16.set(landmarks, this.landmarksPtr / Uint16Array.BYTES_PER_ELEMENT);\n\n        // console.time(\"pose\");\n        const ptr = this.findPose(this.landmarksPtr, this._width, this._height);\n        // console.timeEnd(\"pose\");\n\n        let pose = new Float64Array(this._Module.HEAPF64.buffer, ptr, this._featuresLength);\n\n        const quat = pose.slice(0, this._rotLength);\n        const trans = pose.slice(this._rotLength, this._poseLength);\n\n        this._Module._free(ptr);\n\n        return {\n            rotation: quat,\n            translation: trans\n        };\n    }\n}\n","function isMobile() {\n    let mobile = false;\n    (function(a){if(/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0,4))) mobile = true;})(navigator.userAgent||navigator.vendor||window.opera);\n    return mobile;\n};\n\nexport class GrayScaleMedia\n{\n    constructor(source, width, height, canvas) {\n        this._source = source;\n        this._width = width;\n        this._height = height;\n        this._canvas = canvas ? canvas : document.createElement(\"canvas\");\n        this._canvas.width = width;\n        this._canvas.height = height;\n\n        this._flipImageProg = require(\"./shaders/flip-image.glsl\");\n        this._grayscaleProg = require(\"./shaders/grayscale.glsl\");\n        this.glReady = false;\n        this.initGL(this._flipImageProg, this._grayscaleProg);\n    }\n\n    initGL(vertShaderSource, fragShaderSource) {\n        this.gl = this._canvas.getContext(\"webgl\");\n\n        this.gl.viewport(0, 0, this.gl.drawingBufferWidth, this.gl.drawingBufferHeight);\n        this.gl.clearColor(0.1, 0.1, 0.1, 1.0);\n        this.gl.clear(this.gl.COLOR_BUFFER_BIT);\n\n        const vertShader = this.gl.createShader(this.gl.VERTEX_SHADER);\n        const fragShader = this.gl.createShader(this.gl.FRAGMENT_SHADER);\n\n        this.gl.shaderSource(vertShader, vertShaderSource);\n        this.gl.shaderSource(fragShader, fragShaderSource);\n\n        this.gl.compileShader(vertShader);\n        this.gl.compileShader(fragShader);\n\n        const program = this.gl.createProgram();\n        this.gl.attachShader(program, vertShader);\n        this.gl.attachShader(program, fragShader);\n\n        this.gl.linkProgram(program);\n\n        this.gl.useProgram(program);\n\n        const vertices = new Float32Array([\n            -1, -1,\n            -1,  1,\n             1,  1,\n            -1, -1,\n             1,  1,\n             1, -1,\n        ]);\n\n        const buffer = this.gl.createBuffer();\n        this.gl.bindBuffer(this.gl.ARRAY_BUFFER, buffer);\n        this.gl.bufferData(this.gl.ARRAY_BUFFER, vertices, this.gl.STATIC_DRAW);\n\n        const positionLocation = this.gl.getAttribLocation(program, \"position\");\n        this.gl.vertexAttribPointer(positionLocation, 2, this.gl.FLOAT, false, 0, 0);\n        this.gl.enableVertexAttribArray(positionLocation);\n\n        this.flipYLocation = this.gl.getUniformLocation(program, \"flipY\");\n        this.flipXLocation = this.gl.getUniformLocation(program, \"flipX\");\n        this.gl.uniform1f(this.flipYLocation, -1);\n\n        const texture = this.gl.createTexture();\n        this.gl.activeTexture(this.gl.TEXTURE0);\n        this.gl.bindTexture(this.gl.TEXTURE_2D, texture);\n\n        // if either dimension of image is not a power of 2\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE);\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE);\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.LINEAR);\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.LINEAR);\n\n        this.glReady = true;\n        this.pixelBuf = new Uint8Array(this.gl.drawingBufferWidth * this.gl.drawingBufferHeight * 4);\n        this.grayBuf = new Uint8Array(this.gl.drawingBufferWidth * this.gl.drawingBufferHeight);\n    }\n\n    flipHorizontal() {\n        this.gl.uniform1f(this.flipXLocation, -1);\n    }\n\n    getFrame() {\n        if (!this.glReady) return undefined;\n\n        this.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, this.gl.RGBA, this.gl.UNSIGNED_BYTE, this._source);\n        this.gl.drawArrays(this.gl.TRIANGLES, 0, 6);\n\n        this.gl.readPixels(0, 0, this.gl.drawingBufferWidth, this.gl.drawingBufferHeight, this.gl.RGBA, this.gl.UNSIGNED_BYTE, this.pixelBuf);\n\n        let j = 0;\n        for (let i = 0; i < this.pixelBuf.length; i += 4) {\n            this.grayBuf[j] = this.pixelBuf[i];\n            j++;\n        }\n        return this.grayBuf;\n    }\n\n    requestStream() {\n        return new Promise((resolve, reject) => {\n            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia)\n                return reject();\n\n            // Hack for mobile browsers: aspect ratio is flipped.\n            var aspect = this._width / this._height;\n            if (isMobile()) {\n                aspect = 1 / aspect;\n            }\n\n            navigator.mediaDevices.getUserMedia({\n                audio: false,\n                video: {\n                    width: { ideal: this._width },\n                    height: { ideal: this._height },\n                    aspectRatio: { ideal: aspect },\n                    facingMode: \"environment\"\n                }\n            })\n            .then(stream => {\n                this._source.srcObject = stream;\n                this._source.onloadedmetadata = e => {\n                    this._source.play();\n                    resolve(this._source);\n                };\n            })\n            .catch(err => {\n                reject(err);\n            });\n        });\n    }\n}\n","module.exports = \"attribute vec2 position;\\nvarying vec2 tex_coords;\\nuniform float flipY;\\nuniform float flipX;\\nvoid main(void) {\\ntex_coords = (position + 1.0) / 2.0;\\ntex_coords.y = 1.0 - tex_coords.y;\\ngl_Position = vec4(position * vec2(flipX, flipY), 0.0, 1.0);\\n}\"","module.exports = \"precision highp float;\\nuniform sampler2D u_image;\\nvarying vec2 tex_coords;\\nconst vec3 g = vec3(0.299, 0.587, 0.114);\\nvoid main(void) {\\nvec4 color = texture2D(u_image, tex_coords);\\nfloat gray = dot(color.rgb, g);\\ngl_FragColor = vec4(vec3(gray), 1.0);\\n}\""],"sourceRoot":""}