{"version":3,"sources":["webpack://ARENAFaceTracker/webpack/universalModuleDefinition","webpack://ARENAFaceTracker/webpack/bootstrap","webpack://ARENAFaceTracker/./face-tracker-lib.js","webpack://ARENAFaceTracker/./face-tracker.js","webpack://ARENAFaceTracker/./grayscale.js","webpack://ARENAFaceTracker/./shaders/flip-image.glsl","webpack://ARENAFaceTracker/./shaders/grayscale.glsl"],"names":["FaceTracker","constructor","width","height","init_callback","progress_callback","_this","ready","_width","_height","_init_callback","_progress_callback","_bboxLength","_landmarksLength","_featuresLength","_rotLength","_transLength","_poseLength","FaceDetectorWasm","then","Module","console","log","onWasmInit","getShapePredictor","_Module","initializeShapePredictor","cwrap","detectFaceFeatures","findPose","imBuf","_malloc","landmarksPtr","Uint16Array","BYTES_PER_ELEMENT","callback","req","XMLHttpRequest","addEventListener","e","shapePredictorProgress","open","responseType","onload","payload","response","shapePredictorInit","send","lengthComputable","downloadProgress","loaded","total","data","model","Uint8Array","buf","length","HEAPU8","set","detectFeatures","im","ptr","features","HEAPU16","buffer","bbox","slice","landmarksRaw","_free","landmarks","getPose","pose","Float64Array","HEAPF64","quat","trans","rotation","translation","GrayScaleMedia","source","canvas","_source","_sourceType","_canvas","document","createElement","_flipImageProg","require","_grayscaleProg","glReady","initGL","vertShaderSource","fragShaderSource","gl","getContext","viewport","drawingBufferWidth","drawingBufferHeight","clearColor","clear","COLOR_BUFFER_BIT","vertShader","createShader","VERTEX_SHADER","fragShader","FRAGMENT_SHADER","shaderSource","compileShader","program","createProgram","attachShader","linkProgram","useProgram","vertices","Float32Array","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","positionLocation","getAttribLocation","vertexAttribPointer","FLOAT","enableVertexAttribArray","texture","createTexture","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_MAG_FILTER","pixelBuf","grayBuf","getFrame","undefined","texImage2D","RGBA","UNSIGNED_BYTE","drawArrays","TRIANGLES","readPixels","j","k","i","requestStream","Promise","resolve","reject","navigator","mediaDevices","getUserMedia","audio","video","ideal","aspectRatio","facingMode","stream","srcObject","onloadedmetadata","play","catch","err"],"mappings":"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","file":"arena-face-tracker.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ARENAFaceTracker\"] = factory();\n\telse\n\t\troot[\"ARENAFaceTracker\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./face-tracker-lib.js\");\n","import { FaceTracker } from \"./face-tracker.js\"\nimport { GrayScaleMedia } from \"./grayscale.js\"\n\nexport { FaceTracker, GrayScaleMedia }\n","export class FaceTracker {\n    constructor(width, height, init_callback, progress_callback) {\n        let _this = this;\n        this.ready = false;\n\n        this._width = width;\n        this._height = height;\n\n        this._init_callback = init_callback;\n        this._progress_callback = progress_callback;\n\n        this._bboxLength = 4;\n        this._landmarksLength = 2 * 68;\n        this._featuresLength = this._landmarksLength + this._bboxLength;\n        this._rotLength = 4;\n        this._transLength = 3;\n        this._poseLength = this._rotLength + this._transLength;\n\n        FaceDetectorWasm().then(function (Module) {\n            console.log(\"Face Detector WASM module loaded.\");\n            _this.onWasmInit(Module);\n            _this.getShapePredictor();\n        });\n    }\n\n    onWasmInit(Module) {\n        this._Module = Module;\n\n        this.initializeShapePredictor = this._Module.cwrap(\"pose_model_init\", null, [\"number\", \"number\"]);\n        this.detectFaceFeatures = this._Module.cwrap(\"detect_face_features\", \"number\", [\"number\", \"number\", \"number\"]);\n        this.findPose = this._Module.cwrap(\"get_pose\", \"number\", [\"number\", \"number\", \"number\"]);\n\n        this.imBuf = this._Module._malloc(this._width * this._height);\n        this.landmarksPtr = this._Module._malloc(this._landmarksLength * Uint16Array.BYTES_PER_ELEMENT);\n    }\n\n    getShapePredictor(callback) {\n        const req = new XMLHttpRequest();\n        req.addEventListener('progress', e => this.shapePredictorProgress(e));\n        req.open(\"GET\", \"/shape_predictor_68_face_landmarks_compressed.dat\", true);\n        req.responseType = \"arraybuffer\";\n        req.onload = e => {\n            const payload = req.response;\n            if (payload) {\n                this.shapePredictorInit(payload);\n            }\n        }\n        req.send(null);\n    }\n\n    shapePredictorProgress(e) {\n        if (e.lengthComputable) {\n            const downloadProgress = (e.loaded / e.total) * 100;\n            if (downloadProgress < 100) {\n                this._progress_callback(downloadProgress);\n            }\n        }\n        else {\n            console.log(\"Cannot log face model download progress!\");\n        }\n    }\n\n    shapePredictorInit(data) {\n        const model = new Uint8Array(data);\n        const buf = this._Module._malloc(model.length);\n        this._Module.HEAPU8.set(model, buf);\n        this.initializeShapePredictor(buf, model.length);\n        this._init_callback();\n        this.ready = true;\n    }\n\n    detectFeatures(im) {\n        this._Module.HEAPU8.set(im, this.imBuf);\n\n        // console.time(\"features\");\n        const ptr = this.detectFaceFeatures(this.imBuf, this._width, this._height);\n        // console.timeEnd(\"features\");\n        let features = new Uint16Array(this._Module.HEAPU16.buffer, ptr, this._featuresLength);\n\n        const bbox = features.slice(0, this._bboxLength);\n        const landmarksRaw = features.slice(this._bboxLength, this._featuresLength);\n\n        this._Module._free(ptr);\n\n        return {\n            bbox: bbox,\n            landmarks: landmarksRaw\n        };\n    }\n\n    getPose(landmarks) {\n        this._Module.HEAPU16.set(landmarks, this.landmarksPtr / Uint16Array.BYTES_PER_ELEMENT);\n\n        // console.time(\"pose\");\n        const ptr = this.findPose(this.landmarksPtr, this._width, this._height);\n        // console.timeEnd(\"pose\");\n\n        let pose = new Float64Array(this._Module.HEAPF64.buffer, ptr, this._featuresLength);\n\n        const quat = pose.slice(0, this._rotLength);\n        const trans = pose.slice(this._rotLength, this._poseLength);\n\n        this._Module._free(ptr);\n\n        return {\n            rotation: quat,\n            translation: trans\n        };\n    }\n}\n","export class GrayScaleMedia\n{\n    constructor(source, width, height, canvas) {\n        this._source = source;\n        this._sourceType = typeof this._source;\n        this._width = width;\n        this._height = height;\n        this._canvas = canvas ? canvas : document.createElement(\"canvas\");\n        this._canvas.width = width;\n        this._canvas.height = height;\n\n        this._flipImageProg = require(\"./shaders/flip-image.glsl\");\n        this._grayscaleProg = require(\"./shaders/grayscale.glsl\");\n        this.glReady = false;\n        this.initGL(this._flipImageProg, this._grayscaleProg);\n    }\n\n    initGL(vertShaderSource, fragShaderSource) {\n        this.gl = this._canvas.getContext(\"webgl\");\n\n        this.gl.viewport(0, 0, this.gl.drawingBufferWidth, this.gl.drawingBufferHeight);\n        this.gl.clearColor(0.1, 0.1, 0.1, 1.0);\n        this.gl.clear(this.gl.COLOR_BUFFER_BIT);\n\n        const vertShader = this.gl.createShader(this.gl.VERTEX_SHADER);\n        const fragShader = this.gl.createShader(this.gl.FRAGMENT_SHADER);\n\n        this.gl.shaderSource(vertShader, vertShaderSource);\n        this.gl.shaderSource(fragShader, fragShaderSource);\n\n        this.gl.compileShader(vertShader);\n        this.gl.compileShader(fragShader);\n\n        const program = this.gl.createProgram();\n        this.gl.attachShader(program, vertShader);\n        this.gl.attachShader(program, fragShader);\n\n        this.gl.linkProgram(program);\n\n        this.gl.useProgram(program);\n\n        const vertices = new Float32Array([\n            -1, -1,\n            -1,  1,\n             1,  1,\n            -1, -1,\n             1,  1,\n             1, -1,\n        ]);\n\n        const buffer = this.gl.createBuffer();\n        this.gl.bindBuffer(this.gl.ARRAY_BUFFER, buffer);\n        this.gl.bufferData(this.gl.ARRAY_BUFFER, vertices, this.gl.STATIC_DRAW);\n\n        const positionLocation = this.gl.getAttribLocation(program, \"position\");\n\n        this.gl.vertexAttribPointer(positionLocation, 2, this.gl.FLOAT, false, 0, 0);\n        this.gl.enableVertexAttribArray(positionLocation);\n\n        const texture = this.gl.createTexture();\n        this.gl.activeTexture(this.gl.TEXTURE0);\n        this.gl.bindTexture(this.gl.TEXTURE_2D, texture);\n\n        // if either dimension of image is not a power of 2\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE);\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE);\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.LINEAR);\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.LINEAR);\n\n        this.glReady = true;\n        this.pixelBuf = new Uint8Array(this.gl.drawingBufferWidth * this.gl.drawingBufferHeight * 4);\n        this.grayBuf = new Uint8Array(this.gl.drawingBufferWidth * this.gl.drawingBufferHeight);\n    }\n\n    getFrame() {\n        if (!this.glReady) return undefined;\n\n        this.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, this.gl.RGBA, this.gl.UNSIGNED_BYTE, this._source);\n        this.gl.drawArrays(this.gl.TRIANGLES, 0, 6);\n\n        this.gl.readPixels(0, 0, this.gl.drawingBufferWidth, this.gl.drawingBufferHeight, this.gl.RGBA, this.gl.UNSIGNED_BYTE, this.pixelBuf);\n\n        // webgl returns flipped image, so we will need to flip image buffer to return the correct orientation\n        let j = this.grayBuf.length - this.gl.drawingBufferWidth, k = 0;\n        for (let i = 0; i < this.pixelBuf.length; i += 4) {\n            this.grayBuf[j+k] = this.pixelBuf[i];\n            k++;\n            if (k == this.gl.drawingBufferWidth) {\n                j -= this.gl.drawingBufferWidth;\n                k = 0;\n            }\n        }\n        return this.grayBuf;\n    }\n\n    requestStream() {\n        return new Promise((resolve, reject) => {\n            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia)\n                return reject();\n\n            navigator.mediaDevices.getUserMedia({\n                audio: false,\n                video: {\n                    width: { ideal: this._width },\n                    height: { ideal: this._height },\n                    aspectRatio: { ideal: this._width / this._height },\n                    facingMode: \"environment\"\n                }\n            })\n            .then(stream => {\n                this._source.srcObject = stream;\n                this._source.onloadedmetadata = e => {\n                    this._source.play();\n                    resolve(this._source, stream);\n                };\n            })\n            .catch(err => {\n                reject(err);\n            });\n        });\n    }\n}\n","module.exports = \"attribute vec2 position;\\nvarying vec2 tex_coords;\\nvoid main(void) {\\ntex_coords = (position + 1.0) / 2.0;\\ntex_coords.y = 1.0 - tex_coords.y;\\ngl_Position = vec4(position, 0.0, 1.0);\\n}\"","module.exports = \"precision highp float;\\nuniform sampler2D u_image;\\nvarying vec2 tex_coords;\\nconst vec3 g = vec3(0.299, 0.587, 0.114);\\nvoid main(void) {\\nvec4 color = texture2D(u_image, tex_coords);\\nfloat gray = dot(color.rgb, g);\\ngl_FragColor = vec4(vec3(gray), 1.0);\\n}\""],"sourceRoot":""}